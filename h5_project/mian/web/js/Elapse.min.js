!function(){function replaceAB(a){return escapehash[a]}function trim(a){return a.replace(REG_EXP.R_TRIM,"")}function inArray(a,b){for(var c=0,d=b.length;d>c;++c)if(b[c]==a)return!0;return!1}function Template(options){var name,includes,loadCount,hasInclude,includeName,self=this;if(this.compiled=Translater.start(options.source),eval("this.builder = function () {"+this.compiled.builderSource+"};"),this.compiled.userSettings){if(name=this.compiled.userSettings[KEYWORD.NAME],includes=this.compiled.userSettings[KEYWORD.INCLUDE],loadCount=0,hasInclude=!1,includes)for(includeName in includes)0==TEMPLATES.hasOwnProperty(includeName)&&(hasInclude=!0,++loadCount,loadTemplate(includeName,function(){--loadCount<=0&&(name&&window[RUNTIME].register(name,self),options.complete(self))}));0==hasInclude&&(name&&window[RUNTIME].register(name,this),options.complete(self))}delete this.compiled}function loadTemplate(a,b){templateLoader(a,function(a){Engine.compile({source:a,complete:function(a){b&&b(a)}})})}var wrou,STATE,KEYWORD,KEYWORD_STR,keyWordName,WORD_CONSTANT,SINGLE_KEYWORD,TEMP_VAR_MAP,TEMP_SHORTVARNAME,name,PARSEVAL_STATE,PARSE_ITERVALNAME,FIND_LOOP_SETTINGS,Translater,templateLoader,Engine,REG_EXP={R_N:/\n/g,R_R:/\r/g,R_T:/\t/g,R_F:/\f/g,R_AB:/[&<>"]/gim,R_QUOTE:/\"/g,R_SLASH:/\\/g,R_TRIM:/(^\s*)|(\s*$)/g},escapehash={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},RUNTIME="#TERUNTIME",TEMPLATES={};window[RUNTIME]={outputVal:function(a,b){return 0!=b?wrou(a):a},outputUnicode:function(a){return"string"==typeof a?a.replace(REG_EXP.R_AB,replaceAB):a},register:function(a,b){TEMPLATES[a]=b},include:function(a,b){if(void 0==TEMPLATES[a])throw'include exception: name "'+a+'" not found.';return TEMPLATES[a].render({data:b})}},wrou=window[RUNTIME].outputUnicode,STATE={STATIC_CONTENT:0,JAVASCRIPT:1,OUTPUT_VAL:2,END_MARKER:3,KEYWORD:4,IF_CON:5,ELSEIF_CON:6,FORARR_CON:7,SWITCH_CON:8,CASE_CON:9,FOREACH_CON:10,FOR_CON:11,EVAL_CON:12,SET_CON:13,IDEL:14,NAME_CON:15,INCLUDE_CON:16,LOOP_CON:17,WHILE_CON:18},KEYWORD={IF:"if",FOREACH:"foreach",FORARR:"forarr",FOR:"for",SWITCH:"switch",ELSE:"else",ELSE_IF:"elseif",CASE:"case",BREAK:"break",CONTINUE:"continue",EVAL:"eval",SET:"set",NAME:"name",INCLUDE:"include",LOOP:"loop",WHILE:"while",DEFAULT:"default"},KEYWORD_STR=[];for(keyWordName in KEYWORD)KEYWORD_STR.push(KEYWORD[keyWordName]);WORD_CONSTANT=["true","false","undefined","null","NaN","new","delete"],SINGLE_KEYWORD=[KEYWORD.BREAK,KEYWORD.CONTINUE,KEYWORD.CASE,KEYWORD.ELSE,KEYWORD.ELSE_IF,KEYWORD.EVAL,KEYWORD.SET,KEYWORD.NAME,KEYWORD.INCLUDE,KEYWORD.DEFAULT],TEMP_VAR_MAP={length:"l",index:"i",value:"tv",key:"k",over:"o",step:"st"},TEMP_SHORTVARNAME=[];for(name in TEMP_VAR_MAP)TEMP_SHORTVARNAME.push(TEMP_VAR_MAP[name]);PARSEVAL_STATE={FOUND_VAL:0,FINDING:1,FOUND_STR_START_QUOTE:2,FOUND_STR_START_SINGLEQUOTE:3,FOUND_LEFT_SQUARE:4,FOUND_RIGHT_SQUARE:5},PARSE_ITERVALNAME={FOUND_AS:1,FOUND_STR_START_QUOTE:2,FOUND_STR_START_SINGLEQUOTE:3,FOUND_LEFT_SQUARE:4,FOUND_RIGHT_SQUARE:5,FINDING:6,FOUND_VAL:7},FIND_LOOP_SETTINGS={FOUND_STR_START_QUOTE:2,FOUND_STR_START_SINGLEQUOTE:3,FOUND_LEFT_SQUARE:4,FOUND_RIGHT_SQUARE:5,FINDING:6,FOUND_VAL:7},Translater={parseStaticContent:function(a){return'cb.push("'+a.replace(REG_EXP.R_SLASH,"\\\\").replace(REG_EXP.R_QUOTE,'\\"')+'");'},parseLoopSetting:function(a){var e,f,g,h,b=FIND_LOOP_SETTINGS.FINDING,c=[],d=[];for(a=trim(a),e=0,f=a.length;f>e;++e)switch(g=a.charAt(e),b){case FIND_LOOP_SETTINGS.FINDING:if(","==g){c.push(d.join("")),d=[];continue}if(e==a.length-1){d.push(g),c.push(d.join("")),d=[];continue}if(d.push(g),'"'==g){b=FIND_LOOP_SETTINGS.FOUND_STR_START_QUOTE;continue}if("'"==g){b=FIND_LOOP_SETTINGS.FOUND_STR_START_SINGLEQUOTE;continue}if(h=g.charCodeAt(0),"@"==g||"#"==g||36==h||95==h||h>=97&&122>=h||h>=65&&90>=h){b=FIND_LOOP_SETTINGS.FOUND_VAL;continue}break;case FIND_LOOP_SETTINGS.FOUND_STR_START_QUOTE:if(d.push(g),'"'==g){b=FIND_LOOP_SETTINGS.FINDING;continue}break;case FIND_LOOP_SETTINGS.FOUND_STR_START_SINGLEQUOTE:if(d.push(g),"'"==g){b=FIND_LOOP_SETTINGS.FINDING;continue}break;case FIND_LOOP_SETTINGS.FOUND_LEFT_SQUARE:if(d.push(g),"]"==g){b=FIND_LOOP_SETTINGS.FOUND_VAL;continue}break;case FIND_LOOP_SETTINGS.FOUND_VAL:if(h=g.charCodeAt(0),"["==g){d.push(g),b=FIND_LOOP_SETTINGS.FOUND_LEFT_SQUARE;continue}if("#"==g||parseInt(g)==g||"."==g||"["==g||"]"==g||36==h||95==h||h>=97&&122>=h||h>=65&&90>=h){d.push(g);continue}","==g&&--e,b=FIND_LOOP_SETTINGS.FINDING;continue}return c},parseIterValName:function(a){var f,g,h,i,b=PARSE_ITERVALNAME.FINDING,c=[],d=[],e=[];for(f=0,g=a.length;g>f;++f)switch(h=a.charAt(f),b){case PARSE_ITERVALNAME.FINDING:if("a"==h&&"s"==a.charAt(f+1)&&" "==a.charAt(f+2)){f+=2,b=PARSE_ITERVALNAME.FOUND_AS;continue}if(c.push(h),'"'==h){b=PARSE_ITERVALNAME.FOUND_STR_START_QUOTE;continue}if("'"==h){b=PARSE_ITERVALNAME.FOUND_STR_START_SINGLEQUOTE;continue}if(i=h.charCodeAt(0),"@"==h||"#"==h||36==i||95==i||i>=97&&122>=i||i>=65&&90>=i){b=PARSE_ITERVALNAME.FOUND_VAL;continue}break;case PARSE_ITERVALNAME.FOUND_AS:if(" "==h||f==a.length-1){if(e.length<=0)continue;e.push(h),b=PARSE_ITERVALNAME.FINDING,d.push(e.join("")),e=[];continue}e.push(h);continue;case PARSE_ITERVALNAME.FOUND_STR_START_QUOTE:if(c.push(h),'"'==h){b=PARSE_ITERVALNAME.FINDING;continue}break;case PARSE_ITERVALNAME.FOUND_STR_START_SINGLEQUOTE:if(c.push(h),"'"==h){b=PARSE_ITERVALNAME.FINDING;continue}break;case PARSE_ITERVALNAME.FOUND_LEFT_SQUARE:if(c.push(h),"]"==h){b=PARSE_ITERVALNAME.FOUND_VAL;continue}break;case PARSE_ITERVALNAME.FOUND_VAL:if(i=h.charCodeAt(0),"["==h){c.push(h),b=PARSE_ITERVALNAME.FOUND_LEFT_SQUARE;continue}if("#"==h||parseInt(h)==h||"."==h||"["==h||"]"==h||36==i||95==i||i>=97&&122>=i||i>=65&&90>=i){c.push(h);continue}c.push(h),b=PARSE_ITERVALNAME.FINDING;continue}return[c.join(""),d[0]]},parseVal:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(a+=" ",b=PARSEVAL_STATE.FINDING,c=[],d=[],e=0,f=a.length;f>e;++e)switch(g=a.charAt(e),b){case PARSEVAL_STATE.FINDING:if('"'==g){b=PARSEVAL_STATE.FOUND_STR_START_QUOTE,c.push(g);continue}if("'"==g){b=PARSEVAL_STATE.FOUND_STR_START_SINGLEQUOTE,c.push(g);continue}if(h=g.charCodeAt(0),"@"==g||"#"==g||36==h||95==h||h>=97&&122>=h||h>=65&&90>=h){d=[g],b=PARSEVAL_STATE.FOUND_VAL;continue}c.push(g);break;case PARSEVAL_STATE.FOUND_STR_START_QUOTE:if(c.push(g),'"'==g){b=PARSEVAL_STATE.FINDING;continue}break;case PARSEVAL_STATE.FOUND_STR_START_SINGLEQUOTE:if(c.push(g),"'"==g){b=PARSEVAL_STATE.FINDING;continue}break;case PARSEVAL_STATE.FOUND_LEFT_SQUARE:if(d.push(g),"]"==g&&(i=d.join(""),j=i.indexOf("["),k=i.lastIndexOf("]"),-1!=j&&-1!=k)){l=Translater.parseVal(trim(i.substring(j+1,k))),i=i.substring(0,j+1)+l+i.substr(k),b=PARSEVAL_STATE.FOUND_VAL,d=[i];continue}break;case PARSEVAL_STATE.FOUND_VAL:if(h=g.charCodeAt(0),"["==g){b=PARSEVAL_STATE.FOUND_LEFT_SQUARE,d.push(g);continue}if(!("#"==g||parseInt(g)==g||"."==g||"["==g||"]"==g||36==h||95==h||h>=97&&122>=h||h>=65&&90>=h)){if(b=PARSEVAL_STATE.FINDING,i=d.join(""),0==inArray(i,WORD_CONSTANT))switch(i.charAt(0)){case"#":i=i.substr(1),"."==i.charAt(0)&&(i=i.substr(1)),i=i&&i.length>0?"["==i.charAt(0)?"vsb"+i:"vsb."+i:"vsb",d=[i];break;case"@":i=i.substr(1),"."==i.charAt(0)&&(i=i.substr(1)),i=i&&i.length>0?"["==i.charAt(0)?"window"+i:"window."+i:"window",d=[i];break;default:if(m=d.join("").split("."),n=m.shift().split("#"),o=n.shift(),n.length>0){if(p=TEMP_VAR_MAP[n[0]],void 0===p)throw'tempvar exception: no such tempvar "#'+p+'".';m.unshift(p)}else m.unshift("v");q=o.split("["),q.length>1?(r="v["+q.slice(1),q.splice(1),q=q.concat(r),d=["tsb."+q.join(".")]):d=["tsb."+o+"."+m.join(".")]}d.push(g),c=c.concat(d),d=[];continue}d.push(g)}return c=c.join(""),c.substr(0,c.length-1)},start:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;for(a+=" ",b=['var vsb=arguments[0],tsb={},settings={},rt=window["'+RUNTIME+'"],cb=[];'],c=[],d=[],e=[],f=[],g=0,h={},i=STATE.STATIC_CONTENT,j=!1,k=0,l=a.length;l>k;++k)if(m=a.charAt(k),"}"!=m)switch(i){case STATE.STATIC_CONTENT:if("$"==m&&"{"==a.charAt(k+1)){trim(c.join("")).length>0&&b.push(Translater.parseStaticContent(c.join(""))),c=[],i=STATE.JAVASCRIPT,g=0,++k;continue}c.push(m);break;case STATE.JAVASCRIPT:switch(m){case"\\":if(0==g){if(c.push(a.charAt(k+1)),"}"!=a.charAt(k+2))return;i=STATE.STATIC_CONTENT,++k,++g;continue}break;case"/":if(0==g){b.push("}"),i=STATE.END_MARKER,++g;continue}default:if(" "!=m)d.push(m);else if(d.length>0){i=STATE.KEYWORD,++g;continue}}break;case STATE.OUTPUT_VAL:e.push(m);break;case STATE.IF_CON:f.push(m);break;case STATE.ELSEIF_CON:f.push(m);break;case STATE.FORARR_CON:f.push(m);break;case STATE.FOREACH_CON:f.push(m);break;case STATE.FOR_CON:f.push(m);break;case STATE.SWITCH_CON:f.push(m);break;case STATE.CASE_CON:f.push(m);break;case STATE.LOOP_CON:f.push(m);break;case STATE.EVAL_CON:f.push(m);break;case STATE.SET_CON:f.push(m);break;case STATE.END_MARKER:break;case STATE.NAME_CON:f.push(m);break;case STATE.WHILE_CON:f.push(m);break;case STATE.INCLUDE_CON:f.push(m);break;case STATE.IDEL:break;case STATE.KEYWORD:switch(d.join("")){case KEYWORD.IF:if(f.length>0){b.push(Translater.parseVal(f.join(""))+"){"),f=[],d=[],i=STATE.STATIC_CONTENT;continue}b.push("if("),f=[m],i=STATE.IF_CON;continue;case KEYWORD.ELSE:b.push("}else{"),d=[],i=STATE.STATIC_CONTENT;break;case KEYWORD.ELSE_IF:if(f.length>0){b.push(Translater.parseVal(f.join(""))+"){"),f=[],d=[],i=STATE.STATIC_CONTENT;continue}b.push("}else if("),f=[m],i=STATE.ELSEIF_CON;break;case KEYWORD.SWITCH:if(f.length>0){b.push(Translater.parseVal(f.join(""))+"){"),f=[],d=[],i=STATE.STATIC_CONTENT;continue}b.push("switch("),f=[m],i=STATE.SWITCH_CON;continue;case KEYWORD.CASE:if(f.length>0){b.push(Translater.parseVal(f.join(""))+":"),f=[],d=[],i=STATE.STATIC_CONTENT;continue}b.push("case "),f=[m],i=STATE.CASE_CON;break;case KEYWORD.BREAK:b.push("break;"),d=[],i=STATE.STATIC_CONTENT;break;case KEYWORD.CONTINUE:b.push("continue;"),d=[],i=STATE.STATIC_CONTENT;break;case KEYWORD.DEFAULT:b.push("default:"),d=[],i=STATE.STATIC_CONTENT;break;case KEYWORD.EVAL:if(f.length>0){b.push(Translater.parseVal(f.join(""))+";"),f=[],d=[],i=STATE.STATIC_CONTENT;continue}f=[m],i=STATE.EVAL_CON;continue;case KEYWORD.SET:if(f.length>0){n=f.join("").split(":"),b.push('settings["'+trim(n[0])+'"]='+trim(n[1])+";"),f=[],d=[],i=STATE.STATIC_CONTENT;continue}f=[m],i=STATE.SET_CON;continue;case KEYWORD.NAME:if(f.length>0){h[KEYWORD.NAME]=trim(f.join("")),f=[],d=[],i=STATE.STATIC_CONTENT;continue}f=[m],i=STATE.NAME_CON;continue;case KEYWORD.INCLUDE:if(f.length>0){n=f.join("").split(":"),n[1]=n.length>=2?trim(n.slice(1).join(":")):null,b.push('cb.push(rt.include("'+n[0]+'",'+(n[1]?Translater.parseVal(n[1]):null)+"));"),h[KEYWORD.INCLUDE]=h[KEYWORD.INCLUDE]||{},h[KEYWORD.INCLUDE][n[0]]=!0,f=[],d=[],i=STATE.STATIC_CONTENT;continue}f=[m],i=STATE.INCLUDE_CON;continue;case KEYWORD.FORARR:if(f.length>0){o=Translater.parseIterValName(f.join("")),p='tsb["'+(o[1]||(new Date).getTime())+'"]',q=p+".i",r=p+".l",s=trim(Translater.parseVal(o[0])),b.push(p+"={};for("+q+"=0,"+r+"="+s+".length;"+q+"<"+r+";++"+q+"){"+p+".v"+"="+s+"["+q+"];"),f=[],d=[],i=STATE.STATIC_CONTENT;continue}f=[m],i=STATE.FORARR_CON;continue;case KEYWORD.FOREACH:if(f.length>0){o=Translater.parseIterValName(f.join("")),p='tsb["'+(o[1]||(new Date).getTime())+'"]',t=p+".k",s=Translater.parseVal(o[0]),b.push(p+"={};for("+t+" in "+s+"){"+p+".v="+s+"["+t+"];"),f=[],d=[],i=STATE.STATIC_CONTENT;continue}f=[m],i=STATE.FOREACH_CON;continue;case KEYWORD.LOOP:if(f.length>0){o=Translater.parseIterValName(f.join("")),p='tsb["'+(o[1]||(new Date).getTime())+'"]',q=p+".v",r=p+".o",u=p+".st",n=Translater.parseLoopSetting(o[0]),n.length<=1&&n.push(1),n.length<=2&&n.push(0),b.push(p+"={};for("+q+"="+Translater.parseVal(n[2])+","+r+"="+Translater.parseVal(n[0])+","+u+"="+Translater.parseVal(n[1])+";"+q+"<"+r+";"+q+"+="+u+"){"),f=[],d=[],i=STATE.STATIC_CONTENT;continue}f=[m],i=STATE.LOOP_CON;continue;case KEYWORD.WHILE:if(f.length>0){b.push("while("+Translater.parseVal(f.join(""))+"){"),f=[],d=[],i=STATE.STATIC_CONTENT;continue}f=[m],i=STATE.WHILE_CON;continue;default:++g,e.push(d.join("")+(j?"":m)),i=STATE.OUTPUT_VAL,f=[],d=[];continue}}else{switch(i){case STATE.OUTPUT_VAL:b.push("cb.push(rt.outputVal("+Translater.parseVal(e.join(""))+',settings["filter_data"]));'),e=[];break;case STATE.STATIC_CONTENT:0==j&&c.push(m)}if(d.length>0){i=STATE.KEYWORD,j=!0,k-=2;continue}j=!1,i=STATE.STATIC_CONTENT}return c.length>0&&b.push(Translater.parseStaticContent(c.join(""))),b.push('return cb.join("");'),{builderSource:b.join("").replace(REG_EXP.R_N,"\\n").replace(REG_EXP.R_R,"\\r").replace(REG_EXP.R_T,"\\t").replace(REG_EXP.R_F,"\\f"),userSettings:h}}},Template.prototype.render=function(a){return a=a||{},this.builder(a.data)},templateLoader=function(a,b){b('"'+a+'"�޷����أ�δ����loader��')},Engine={setLoader:function(a){templateLoader=a.loader},renderFromSource:function(a){a=a||{},Engine.compile({source:a.source,complete:function(b){var c=Engine.render({template:b,data:a.data});a.complete(c)}})},render:function(a){return a=a||{},a.template.render({data:a.data||{}})},compile:function(a){a=a||{},new Template({source:a.source,complete:function(b){a.complete(b)}})},getTemplate:function(a){a=a||{},TEMPLATES.hasOwnProperty(a.name)?a.complete&&a.complete(TEMPLATES[a.name]):loadTemplate(a.name,function(b){a.complete&&a.complete(b)})},removeTemplate:function(a){a=a||{},delete TEMPLATES[a.name]}},window.Elapse=Engine}();