<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>采购管理 - 采购订单详情 -后台管理系统</title>
<link rel="stylesheet" type="text/css" href="themes/default/easyui.css" />
<link rel="stylesheet" type="text/css" href="themes/icon.css" />
<link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="css/bootstrap-theme.css" />
<link rel="stylesheet" type="text/css" media="all" href="css/easyui-repair.css" />
<link rel="stylesheet" type="text/css" media="all" href="css/style.css" />
</head>
<body>

<!-- head begin-->
<div id="all-head">
	<div class="headlogo"><img src="images/logo.png" height="40" width="200" alt="" /></div>
	<div class="headtools">
		<p class="p-tools">欢迎你，<strong class="strong-user">admin</strong> <span rel="form.html" class="s-tools a-userSetting">账号设置</span><span class="s-tools s-loginout">退出</span></p>
		<div class="headmes">
			<span class="s-message">消息<small class="small-num">3</small></span>
			<ul class="ul-mesInfo">
				<li class="li-sj">&nbsp;</li>
				<li class="li-nomes">暂无新的消息！</li>
				<li class="li-mes"><span class="s-newwin" rel="list.html" title="咨询处理">有1个咨询需要您处理。</span></li>
				<li class="li-mes"><span class="s-newwin" rel="list.html" title="订单发货">有2个订单需要您发货</span></li>
				<li class="li-mes"><span class="s-newwin" rel="list.html" title="结算订单">有2个新订单需要您结算</span></li>
			</ul>
		</div>
	</div>
</div>
<!-- head end -->

<!-- side begin -->
<div id="all-side">
	<div id="nav">
		<ul class="ul-nav">
			<li class="li-nav">
				<a class="s-nav" target="_blank" href="prolist.html">
					<em class="em-icon"><img src="images/icon/stack-25.png" height="25" width="25" alt="" /></em>
					<b class="b-nav">商品</b>
				</a>
				<div class="sidemenu">
					<h5 class="h5-menu">商品管理</h5>
					<ul class="ul-subnav">
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="prolist.html">商品列表</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="proDetails.html">商品新增</a></li>
					</ul>
				</div>
			</li>
			<li class="li-nav">
				<a class="s-nav" target="_blank" href="buylist.html">
					<em class="em-icon"><img src="images/icon/shopping_cart-25.png" height="25" width="25" alt="" /></em>
					<b class="b-nav">采购</b>
				</a>
				<div class="sidemenu">
					<h5 class="h5-menu">采购管理</h5>
					<ul class="ul-subnav">
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="needlist.html">采购需求</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="needNotelist.html">采购跟催</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="buylist.html">采购列表</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="buyDetails.html">采购新增</a></li>
					</ul>
				</div>
			</li>
			<li class="li-nav">
				<a class="s-nav" target="_blank" href="bookinglist.html">
					<em class="em-icon"><img src="images/icon/layers-25.png" height="25" width="25" alt="" /></em>
					<b class="b-nav">订单</b>
				</a>
				<div class="sidemenu">
					<h5 class="h5-menu">订单管理</h5>
					<ul class="ul-subnav">
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="bookinglist.html">订单列表</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="bookingDetails.html">订单新增</a></li>
					</ul>
				</div>
			</li>
			<li class="li-nav">
				<a class="s-nav" target="_blank" href="manageIndex.html">
					<em class="em-icon"><img src="images/icon/pawn-25.png" height="25" width="25" alt="" /></em>
					<b class="b-nav">官网</b>
				</a>
				<div class="sidemenu">
					<h5 class="h5-menu">官网管理</h5>
					<ul class="ul-subnav">
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="manageIndex.html">首页管理</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="proShow.html">商品展示</a></li>
						<!-- <li class="li-subnav"><a class="s-subnav" target="_blank" href="proSorting.html">商品排序</a></li> -->
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="managePromotion.html">促销管理</a></li>
					</ul>
				</div>
			</li>
			<li class="li-nav">
				<a class="s-nav" target="_blank" href="bookinglist.html">
					<em class="em-icon"><img src="images/icon/group-25.png" height="25" width="25" alt="" /></em>
					<b class="b-nav">客户</b>
				</a>
				<div class="sidemenu">
					<h5 class="h5-menu">客户管理</h5>
					<ul class="ul-subnav">
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="customerlist.html">客户列表</a></li>
						<!-- <li class="li-subnav"><a class="s-subnav" target="_blank" href="customerDetails.html">客户新增</a></li> -->
					</ul>
				</div>
			</li>
			<li class="li-nav">
				<a class="s-nav" target="_blank" href="moneyImport.html">
					<em class="em-icon"><img src="images/icon/wallet-25.png" height="25" width="25" alt="" /></em>
					<b class="b-nav">资金</b>
				</a>
				<div class="sidemenu">
					<h5 class="h5-menu">资金管理</h5>
					<ul class="ul-subnav">
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="moneyClaim.html">收款认领</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="moneyPay.html">支付列表</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="moneyCheckout.html">订单结算</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="moneyCancel.html">退货结算</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="moneyCost.html">其他结算</a></li>
					</ul>
				</div>
			</li>

			<li class="li-nav">
				<a class="s-nav" target="_blank" href="account.html">
					<em class="em-icon"><img src="images/icon/settings-25.png" height="25" width="25" alt="" /></em>
					<b class="b-nav">系统</b>
				</a>
				<div class="sidemenu">
					<h5 class="h5-menu">系统管理</h5>
					<ul class="ul-subnav">
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="account.html">账号管理</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="role.html">角色管理</a></li>
						<li class="li-subnav"><a class="s-subnav" target="_blank" href="power.html">权限管理</a></li>
					</ul>
				</div>
			</li>
		</ul>
	</div>
</div>
<!-- side end -->
<div class="crumb"><span class="s-title">采购管理 - 采购订单详情</span></div>

<!-- main begin -->
<div id="page-DetailsMainBox">

	<div class="pageMain">

		<form role="form" class="form-horizontal form-valite" method="post" action="">
			<div class="navbar navbar-default searchbar" >
				<div class="pad-l10 pad-t5 btn-group">
					<input class="btn btn-primary" type="submit" value="保 存" />
				      <!-- <button class="btn btn-default grid-edit" type="button"><span class="glyphicon glyphicon-pencil"></span>编辑</button> -->
				      <button class="btn btn-default grid-confirm" type="button"><span class="glyphicon glyphicon-ok"></span>确认</button>
				      <button class="btn btn-default grid-useless" type="button"><span class="glyphicon glyphicon-remove"></span>作废</button>
				      <button class="btn btn-default grid-print" type="button"><span class="glyphicon glyphicon-print"></span>打印</button>
			    </div>
			 </div>
			<div class="pad-t20 pad-b20">
				<div class="formbox-a">
					<div class="grid">
						<div class="col_5">
							<div class="form-group">
								<label class="col_3 control-label right" for="username">采购单号：</label>
								<div class="col_9 mag-t8">C1412300001</div>
							</div>
							<div class="form-group">
								<label class="col_3 control-label right" for="company">供应商：</label>
								<div class="col_9 item-txt"><input type="text" class="form-control" name="proname" id="proname" validate="{required:'请输入供应商'}"></div>
							</div>
							<div class="form-group">
								<label class="col_3 control-label right" for="company">供应商电话：</label>
								<div class="col_9 item-txt"><input type="text" class="form-control" name="proname" id="proname" validate="{required:'请输入供应商电话'}"></div>
							</div>

							<div class="form-group">
								<label class="col_3 control-label right" for="inputSuccess4">采购部：</label>
								<div class="col_9 item-txt">
									<select class="form-control">
										<option value="1">当前用户部门</option>
										<option value="2">部门2</option>
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col_3 control-label right" for="username">创建人：</label>
								<div class="col_9 mag-t8">考拉</div>
							</div>

						</div>

						<div class="col_5">

							<div class="form-group">
								<label class="col_3 control-label right" for="username">状态：</label>
								<div class="col_9 mag-t8">待确认</div>
							</div>

							<div class="form-group">
								<label class="col_3 control-label right" for="company">供应商联系人：</label>
								<div class="col_9 item-txt"><input type="text" class="form-control" name="proname" id="proname" validate="{required:'供应商联系人'}"></div>
							</div>
							<div class="form-group">
								<label class="col_3 control-label right" for="company">供应商地址：</label>
								<div class="col_9 item-txt"><input type="text" class="form-control" name="proname" id="proname"></div>
							</div>

							<div class="form-group">
								<label class="col_3 control-label right" for="inputSuccess4">采购员：</label>
								<div class="col_9 item-txt">
									<select class="form-control">
										<option value="1">当前用户</option>
										<option value="2">用户2</option>
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col_3 control-label right" for="username">创建时间：</label>
								<div class="col_9 mag-t8">2014-12-14 12:14:22</div>
							</div>

						</div>

					</div>
				</div>
			</form>
		</div>


		<div class="btn-group addnewOne pad-l10">
			<button class="btn btn-default btn-addNewSale" type="button"><span class="glyphicon glyphicon-plus"></span>新增</button>
		</div>
		<div class="tableGridbox pad-l10 pad-r10">
			<div id="dataListGrid" data-options="border:false"></div>
		</div>

	</div>


</div>
<!-- main end -->



<div class="none">
	<!-- popProCancel -->
	<div id="popProCancel">
		<div class="popCancelTableGrid">
			<div id="popCancelListGrid" data-options="border:false"></div>
		</div>
		<div class="grid">
			<label class="col_2 control-label right" for="company">取消理由：</label>
			<div class="col_10 item-txt"><textarea id="cancelMessage" name="cancelMessage" class="form-control" rows="3"></textarea></div>
		</div>
		<p class="center pad-t10">
			<input class="btn btn-primary btn-cancelSubmit" type="button" value="确 定" />
			<input class="btn btn-default btn-popCancel" type="button" value="取 消" />
		</p>
	</div>

	<!-- popProAdd -->
	<div id="popProAdd">
		<div id="searchbar" class="navbar navbar-default" >
			<div class="pad10">
				<form role="form" class="form-inline form-popSearch">
					<p class="pad-b5">
						　类型：<select class="form-control input-sm" name="proKind">
							<option value="1">商品类型</option>
						</select>
						　编　码：<input type="text" name="no" class="form-control input-sm">
						名称：<input type="text" name="proname" class="form-control input-sm">
					</p>
					<p class="pad-b5">
						供应商：<select class="form-control input-sm" name="supplier">
							<option value="1">供应商1</option>
							<option value="2">供应商2</option>
						</select>
						 生产款号：<input type="text" name="kh" class="form-control input-sm">
						<input class="btn btn-sm btn-primary btn-popSearch" type="button" value="搜 索" />
					</p>
				</form>
			</div>
		</div>

		<div class="popTableGrid">
			<div id="popProListGrid" data-options="border:false"></div>
		</div>
		<p class="center">
			<input class="btn btn-primary btn-proSubmit" type="button" value="添 加" />
			<input class="btn btn-default btn-popCancel" type="button" value="取 消" />
		</p>
	</div>

</div>



<script id="newPlanOne" type="text/x-jsrender">
<div class="s-jone"><input type="text" class="txt txt-date" name="planDate_{{>no}}" value="" /><input type="text" class="txt txt-number w40" name="planNumber_{{>no}}" value="" /><a class="op-grid op-gridDelPlan" href="#"><span class="glyphicon glyphicon-remove"></span></a></div>
</script>

<script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="js/jquery.easyui.min.js"></script>
<script type="text/javascript" src="js/my97/WdatePicker.js"></script>
<script type="text/javascript" src="js/jquery.easyui.ext.js"></script>
<script type="text/javascript" src="js/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jsrender.js"></script>
<script type="text/javascript" src="js/base.js"></script>
<script type="text/javascript" src="js/tools.js"></script>
<script type="text/javascript" src="js/runing.js"></script>

<script type="text/javascript">

var cancelBuyPro = {
	init : function () {
		var me = this;
		me.cancelPop();
		me.sendData();
	},
	popO : null,
	cancelPop : function () {
		var me = this;
		$('#popProCancel .btn-popCancel').click(function  () {
			me.popO.removePop();
		});
	},
	sendData : function () {
		var me = this;
		$('.btn-cancelSubmit').click(function  () {
			var checkedO = $('#popCancelListGrid').datagrid('getChecked');
			var sendData = {};
			var can = true;
			sendData.message = $.trim($('#cancelMessage').val());
			if (sendData.message=='') {
				$.sobox.alert('提示','取消理由不能为空！',function () {
					$('#cancelMessage').focus();
				});
				return;
			};
			sendData.data = [];
			if(checkedO.length==0){
				can=false
			}else{
				window.console && console.log(checkedO);
				$.each(checkedO,function (i,v) {//获取数据
					var number = $('#cancelNumber_'+v.no).val();
					if (number!=0) {
						sendData.data.push({
							no : v.no,
							number : number
						});
					}else{
						can = false;
						return false;
					};
				});
			}
			//window.console && console.log(sendData,sendData.data);
			if (can) {//如果所选择行数字都为非零则可以提交
				$.reqUrlEx({//增加型ajax请求，带等待状态和成功提示框
					url : 'js/true.json',
					data : sendData,
					//url : 'js/false.json',
					type : 'get',//默认不设置为post
					success : function (data) {
					//data中需带success参数，判断是否请求成功，{success:true}
					//{"success":false,"message":"无法删除此记录！"}
						window.console && console.log(data,'请求成功~');
						me.popO.removePop();
						$T.gridRefresh('#dataListGrid');
					}
				});
			}else{
				$.sobox.alert('提示','至少选择一条并“本次取消”的数量不能为零！');
			};


		});
	},
	popE : function (data) {
		var me = this;
		var data = data;
		me.popO = $.sobox.pop({
			type : 'target',
			target : '#popProCancel',
			title : '商品取消',
			width:680,height:520,
			onPop : function () {
				setTimeout(function () {

				$('#popCancelListGrid').datagrid({
					//title:'DataGrid',
					url:'js/datagrid_demo5.json?no='+data.no,
					 //url:'js/datagrid_data_empty.json',
					method : 'get',//默认是post
					pagination:true,
					//singleSelect : true,
					height:300,
					loadMsg : '玩命加载中...',
					view: myview,
					emptyMsg: '暂无数据...',
					pageSize :10,
					pageList :[10,20,50],
					checkOnSelect : false,
					columns:[[
						{field:'ck',checkbox:true}, //开启多选框 必须：singleSelect : false
						{field:'ot',title:"订单编号",align:'center',formatter:function (value,row,index) {
							var no = row.no;
							var during = row.during;
							var fast = row.fast?"<em class='red'>加急</em>":"";
							return '<span class="s-jone">'+no+'</span><br /><span class="s-jone"><em class="blue">'+during+'</em>'+fast+'</span>';
						}},
						{field:'ot2',title:"时间",align:'center',formatter:function (value,row,index) {
							return '<span class="s-jone">下单：'+row.bookingTime+'</span><br /><span class="s-jone">审核：'+row.checkTime+'</span>';
						}},
						{field:'pic',title:'SKU图片',width:70,align:'center',formatter : function (value,row,index) {
							return '<img src="'+value+'" height="58" width="58" alt="" />';
						//return value;
						}},
						{field:'skuNo',title:'SKU编号',width:82,align:'center'},
						{field:'ohter',title:'颜色/尺码',width:80,align:'center',formatter:function (value,row,index) {
							return row.color+'/'+row.size;
						}},
						{field:'ohter2',title:'订单数量',width:60,align:'center',formatter:function (value,row,index) {
							return '<span class="s-jone">订购：<em id="em-bookingNum-'+index+'" class="em-bookingNum">'+row.bookingNum+'</em></span><br /><span class="s-jone">可发：<b>'+row.canNum+'</b></span>';
						}},
						{field:'ohter3',title:'本次取消',width:60,align:'center',formatter:function (value,row,index) {
							var number = 0;
							//if (value&&value!='') {number = value;};
							return  '<div id="s-proCancelNumber-'+index+'" class="s-jone s-proCancelNumber s-proCancelNumber-'+index+'"><input type="text" class="txt txt-number txt-cancelnum w55" rel="'+row.bookingNum+'" id="cancelNumber_'+row.no+'" name="cancelNumber_'+row.no+'" value="0"  disabled="disabled" /></div>';
						}}
				  	]],
					//check事件 start
					onCheck : function (rowIndex, rowData) {
						$('.s-proCancelNumber-'+rowIndex).find('.txt').prop('disabled',false);
					},
					onUncheck : function (rowIndex, rowData) {
						$('.s-proCancelNumber-'+rowIndex).find('.txt').prop('disabled',true);
					},
					onSelectAll : function () {
						$('.s-proCancelNumber').find('.txt').prop('disabled',false);
					},
					onUnselectAll : function () {
						$('.s-proCancelNumber').find('.txt').prop('disabled',true);
					},
					//check事件 end
					onLoadSuccess : function () {
						$('.popCancelTableGrid').find('.txt-number').keyup(function () {//数字框只能输入数字
							var max = $('#em-bookingNum-'+index).text()*1;
							$T.setNumVal(this,max);
						});
					}
				});


				},200);
			}
		});
	}
}


$('#dataListGrid').datagrid({
	//title:'DataGrid',
	url:'js/datagrid_demo3.json',
	 //url:'js/datagrid_data_empty.json',
	method : 'get',//默认是post
	//width:700,
	// height:500,
	//fitColumns:true,
	pagination:false,
	//singleSelect : true,
	pageSize:10,
	loadMsg : '玩命加载中...',
	view: myview,
	emptyMsg: '暂无数据...',
	nowrap : false,
	pageSize :25,
	pageList :[25,50,100],
	checkOnSelect : false,
	showFooter : true,
	columns:[[
		{field:'ck',checkbox:true}, //开启多选框 必须：singleSelect : false
		{field:'op',title:'操作',width:100,align:'center',formatter : function (value,row,index) {
			var no = row.no;
			return '<a class="op-grid op-gridBuyDel" data-opt={"no":'+no+'} href="#"><span class="glyphicon glyphicon-remove"></span>删除</a><br /><a class="op-grid op-showBuy" target="_blank" href="proDetails.html?no='+no+'"><span class="glyphicon glyphicon-search"></span>商品</a><a class="op-grid op-stopBuy" data-opt={"no":'+no+'} href="#"><span class="glyphicon glyphicon-pencil"></span>取消</a>';
		//return value;
		}},
		{field:'pic',title:'图片',width:70,align:'center',formatter : function (value,row,index) {
			return '<img src="'+value+'" height="58" width="58" alt="" />';
		//return value;
		}},
		{field:'no',title:'SKU编码',width:80,align:'center',formatter:function (value,row,index) {
			var rHtml = '';
			if (value&&value.length>0) {
				$.each(value,function (i,v) {
					rHtml += v+'<br />';
				})
			}else{
				rHtml = '无';
			};
			return rHtml;
		}},

		{field:'ohter',title:'颜色/尺码',width:100,align:'center',formatter:function (value,row,index) {
			return row.color+'/'+row.size;
		}},
		{field:'name',title:'名称',width:200,align:'center'},
		{field:'buyinfo',title:'采购信息',width:110,formatter:function (value,row,index) {
			var no = row.no;
			return '<div class="buyPirceBox"><span class="s-jone">数量：<input type="text" class="txt txt-number txt-buynum w60" name="number_'+no+'" value="'+row.buyNumber+'" /></span>'+
			'<span class="s-jone">单价：<input type="text" class="txt txt-number txt-buyprice w60" name="price_'+no+'" value="'+row.price+'" /></span>'+
			'<span class="s-jone">金额：￥<em class="em-price">'+(row.buyNumber*row.price)+'</em></span></div>';
		}},
		{field:'arriveNumber',title:'到货数量',width:60,align:'center'},
		{field:'booking',title:'来源订单',width:100,align:'center',formatter:function (value,row,index) {
			var rHtml = '';
			if (value&&value.length>0) {
				$.each(value,function (i,v) {
					rHtml += '<a href="buylist.html?no='+v+'">'+v+'</a><br />';
				})
			}else{
				rHtml = '无';
			};
			return rHtml;
		}},
		{field:'plan',title:'到货计划',width:170,align:'center',formatter :function (value,row,index) {
			var no = row.no;
			var rHtml = '<div class="pro-planbox"><div class="pro-plancont">';
			if (value&&value.length>0) {
				$.each(value,function (i,v) {
					rHtml += '<div class="s-jone"><input type="text" class="txt txt-date" name="planDate_'+no+'" value="'+v.date+'" /><input type="text" class="txt txt-number w40" name="planNumber_'+no+'" value="'+v.number+'" /><a class="op-grid op-gridDelPlan" href="#"><span class="glyphicon glyphicon-remove"></span></a></div>';
				});
			}
			rHtml +='</div><span class="s-jone"><a class="op-grid op-gridNewPlan" data-opt={"no":'+no+'} href="#" title="添加新计划"><span class="glyphicon glyphicon-plus-sign"></span>添加新计划</a></span></div>';
			return rHtml;
		}}
  	]],
	onClickRow:function (rowIndex, rowData) {
		//nowSel = rowData;
	},
	onLoadSuccess : function () {
		// window.console && console.log($('.tableGridbox').find('.txt-number').length);

		var $tableBox = $('.tableGridbox');

		//采购价格及数字变化事件 begin
		//setPrice
		function setPrice(obj) {
			var $par = $(obj).parents('.buyPirceBox');
			var num = $par.find('.txt-buynum').val();
			var price = $par.find('.txt-buyprice').val();
			// window.console && console.log(num*price);
			$par.find('.em-price').text(num*price);
			var $allNum = $('.buyPirceBox').find('.txt-buynum');
			var $allPrice = $('.buyPirceBox').find('.em-price');
			var allNum=0,allPrice = 0;
			$allNum.each(function (i,v) {
				allNum += $(v).val()*1;
			});
			$allPrice.each(function (i,v) {
				allPrice += $(v).text()*1;
			});
			$tableBox.find('.footerSum .em-sumNum').text(allNum);
			$tableBox.find('.footerSum .em-sumPrice').text(allPrice);
			// window.console && console.log(allNum,allPrice);
		}

		var sumPrice = 0,sumNum = 0;
		 var $emPrice = $tableBox.find('.em-price');
		 var $buyNum = $tableBox.find('.txt-buynum');
		//计算总价格
		$emPrice.each(function (i,v) {
			sumPrice += $(v).text()*1;
		});
		$buyNum.each(function (i,v) {
			sumNum += $(v).val()*1;
		});

		$tableBox.find('.datagrid-footer-inner').html('<div class="footerSum"><div class="fl space w620">&nbsp;&nbsp;</div><span class="s-sum s-sumNum">商品总数：<em class="em-sumNum green">'+sumNum+'</em></span><span class="s-sum s-sumPrice">商品总金额：<em class="em-sumPrice red">'+sumPrice+'</em></span></div>');//footer内容

		$tableBox.find('.txt-number').keyup(function() {//数字框只能输入数字
			$T.setNumVal(this);
		});
		$tableBox.find('.txt-buynum').blur(function() {//绑定跟踪数字变化
			setPrice(this);
		});
		$tableBox.find('.txt-buyprice').blur(function() {//绑定跟踪价格变化
			setPrice(this);
		});
		//采购价格及数字变化事件 end


		$tableBox.find('.txt-date').each(function(){
			$T.showDate(this);
		});

		$('.op-gridDelPlan').click(function() {//删除当前条计划
			$(this).parents('.s-jone').remove();
			return false;
		});

		$('.op-gridNewPlan').click(function() {//添加新的计划
			var no =$(this).data('opt').no;
			var $par = $(this).parents('.pro-planbox').find('.pro-plancont');
			window.console && console.log($par,no);
			$par.append(
				$('#newPlanOne').render({no:no})
			);
			//新加元素绑定事件
			$par.find('.txt-number:last').keyup(function() {//数字框只能输入数字
				$T.setNumVal(this);
			});
			$T.showDate($par.find('.txt-date:last'));//绑定日历控件
			$par.find('.op-gridDelPlan:last').click(function() {//删除当前条计划
				$(this).parents('.s-jone').remove();
				return false;
			});

			return false;
		});

		$('.op-stopBuy').click(function() {
			var data = $(this).data('opt');
			cancelBuyPro.popE(data);//打开弹窗
		});

		$('.op-gridBuyDel').click(function () {
			var data = $(this).data('opt');
			$.reqUrlEx({
				url : 'js/true.json',
				data :data,
				type : 'get',//默认不设置为post
				msg : '你是否删除此记录？',
				success : function (data) {
					window.console && console.log(data,'请求成功~');
					$T.gridRefresh('#dataListGrid');
				}
			});
		});

	}
});




var addNewPro = {
	init : function  () {
		var me = this;
		me.popE();
		me.searchLoad();
	},
	popAdd : null,
	popE : function  () {
		var me = this;
		$('.btn-addNewSale').click(function() {
			me.popAdd = $.sobox.pop({
				type : 'target',
				target : '#popProAdd',
				title : '增加采购商品',
				width:680,height:520,
				onPop : function () {
					setTimeout(function () {

					$('#popProListGrid').datagrid({
						//title:'DataGrid',
						url:'js/datagrid_demo4.json',
						 //url:'js/datagrid_data_empty.json',
						method : 'get',//默认是post
						pagination:true,
						//singleSelect : true,
						height:300,
						loadMsg : '玩命加载中...',
						view: myview,
						emptyMsg: '暂无数据...',
						pageSize :10,
						pageList :[10,20,50],
						checkOnSelect : false,
						columns:[[
							{field:'ck',checkbox:true}, //开启多选框 必须：singleSelect : false
							//{field:'no',title:"编号",hidden:true},
							{field:'pic',title:'SKU图片',width:70,align:'center',formatter : function (value,row,index) {
								return '<img src="'+value+'" height="58" width="58" alt="" />';
							//return value;
							}},
							{field:'no',title:'生产款号',width:100,align:'center'},
							{field:'skuNo',title:'SKU编号',width:105,align:'center'},
							{field:'ohter',title:'颜色/尺码',width:80,align:'center',formatter:function (value,row,index) {
								return row.color+'/'+row.size;
							}},
							{field:'price',title:'采购单价',width:60,align:'center',formatter:function (value,row,index) {
								var price = 0;
								//if (value&&value!='') {price = value;};
								return  '<div id="s-proAddPrice-'+index+'" class="s-jone s-proAddRow s-proAddPrice s-proAddRow-'+index+'"><input type="text" class="txt txt-number txt-buyprice w55" id="buyPrice_'+row.no+'" name="buyPrice_'+row.no+'" value="'+price+'" disabled="disabled" /></div>';
							}},
							{field:'number',title:'采购数量',width:60,align:'center',formatter:function (value,row,index) {
								var number = 0;
								//if (value&&value!='') {number = value;};
								return  '<div id="s-proAddNumber'+index+'" class="s-jone s-proAddRow s-proAddNumber s-proAddRow-'+index+'"><input type="text" class="txt txt-number txt-buynum w55" id="buyNumber_'+row.no+'" name="buyNumber_'+row.no+'" value="'+number+'"  disabled="disabled" /></div>';
							}},
							{field:'other2',title:'金额',width:80,align:'center',formatter:function (value,row,index) {
								var number = row.number||0;
								var price = row.price||0;
								window.console && console.log(number,price);
								return '<span class="s-jone">￥<em class="em-price">'+(number*price)+'</em></span>';
							}}
					  	]],
						onClickRow:function (rowIndex, rowData) {
						},
						//check事件 start
						onCheck : function (rowIndex, rowData) {
							$('.s-proAddRow-'+rowIndex).find('.txt').prop('disabled',false);
						},
						onUncheck : function (rowIndex, rowData) {
							$('.s-proAddRow-'+rowIndex).find('.txt').prop('disabled',true);
						},
						onSelectAll : function () {
							$('.s-proAddRow').find('.txt').prop('disabled',false);
						},
						onUnselectAll : function () {
							$('.s-proAddRow').find('.txt').prop('disabled',true);
						},
						//check事件 end
						onLoadSuccess : function () {
							window.console && console.log($('.popTableGrid').find('.txt-number').length);
							$('.popTableGrid').find('.txt-number').keyup(function () {//数字框只能输入数字
								$T.setNumVal(this);
							}).blur(function () {
								var $parTr = $(this).parents('tr');
								var price = $parTr.find('.txt-buyprice').val();
								var number = $parTr.find('.txt-buynum').val();
								var sumprice = price*number;
								$parTr.find('.em-price').text(sumprice);
							});
						}
					});


					},200);
				}
			})
		});

		$('#popProAdd .btn-popCancel').click(function  () {
			me.popAdd.removePop();
		});

		$('#popProAdd .btn-proSubmit').click(function  () {
			var checkedO = $('#popProListGrid').datagrid('getChecked');
			if(checkedO.length==0){
				$.sobox.alert('提示','请勾选需要添加的商品！');
				return false;
			}
			var sendData = [];
			var can = true;
			$.each(checkedO,function (i,v) {//获取数据
				var price = $('#buyPrice_'+v.no).val();
				var number = $('#buyNumber_'+v.no).val();
				if (price*number!=0) {
					sendData.push({
						no : v.no,
						price : price,
						number : number
					});
				}else{
					can = false;
					return false;
				};
			});
			window.console && console.log(sendData);
			if (can) {//如果所选择行数字都为非零则可以提交
				$.reqUrlEx({//增加型ajax请求，带等待状态和成功提示框
					url : 'js/true.json',
					data : sendData,
					//url : 'js/false.json',
					type : 'get',//默认不设置为post
					success : function (data) {
					//data中需带success参数，判断是否请求成功，{success:true}
					//{"success":false,"message":"无法删除此记录！"}
						window.console && console.log(data,'请求成功~');
						me.popAdd.removePop();
						$T.gridRefresh('#dataListGrid');
					}
				});
			}else{
				$.sobox.alert('提示','所选行价格和数字都不能为零！');
			};

			// me.popAdd.removePop();
			// $T.gridRefresh('#dataListGrid');

		});

	},
	searchLoad : function () {
		$('.btn-popSearch').click(function () {//搜索重新加载grid
			$T.gridSearchReload('.form-popSearch','#popProListGrid');
		});
	}
}


var $formA = $('.form-valite').soValidate({
	inputPar:'.item-txt',
	submit : function (form) {
		window.console && console.log(form.serializeObject());
		//alert('success');
	},
	fail : function (form,failInputs) {
		window.console && console.log(failInputs);
		var $failF = $(failInputs[0]);
		$("html,body").stop().animate({'scrollTop': $failF.offset().top});//定位到第一个验证失败的对象
		$failF.focus();
	}
});


addNewPro.init();
cancelBuyPro.init();
</script>


</body>
</html>